# S16 Predictor v2.0 æ›´æ–°æ‘˜è¦

**æ›´æ–°æ—¥æœŸ**: 2026-01-07
**æ–‡ä»¶**: `isympred/predictors/s16_predictor.py`

---

## ğŸ¯ æ ¸å¿ƒæ”¹åŠ¨ä¸€è§ˆ

### 1. æ–°å¢åŠŸèƒ½

#### âœ¨ å®¿ä¸»åŒ¹é…æ‰“åˆ†ç³»ç»Ÿ
- **åŠŸèƒ½**: æ ¹æ®ç”¨æˆ·æä¾›çš„å®¿ä¸»ç‰©ç§ï¼Œå¯¹æ•°æ®åº“è®°å½•è¿›è¡Œå®¿ä¸»ç‰¹å¼‚æ€§åŠ æƒ
- **æƒé‡èŒƒå›´**: 0.8 (ä¸åŒ¹é…) ~ 1.5 (ç‰©ç§çº§åŒ¹é…)
- **åŒ¹é…å±‚çº§**: Species > Genus > Family > Order > General > Mismatch
- **å®ç°æ–¹æ³•**:
  - `_query_host_taxonomy()`: æŸ¥è¯¢å®¿ä¸»åˆ†ç±»ä¿¡æ¯
  - `_calculate_host_match_score()`: è®¡ç®—å®¿ä¸»åŒ¹é…æƒé‡

#### âœ¨ è¯æ®ç­‰çº§æ•´åˆ
- **åŠŸèƒ½**: åŸºäºæ–‡çŒ®è´¨é‡å¯¹é¢„æµ‹ç»“æœåŠ æƒ
- **æƒé‡èŒƒå›´**: 0.8 (ä½è´¨é‡) ~ 1.5 (æœ€é«˜è´¨é‡)
- **è¯æ®ç­‰çº§**: 1-5 (åŸºäº Record Type + Genome ID + Journal)
- **æ•°æ®æ¥æº**: æ•°æ®åº“ä¸­çš„ `evidence_level` å­—æ®µ

### 2. è¯„åˆ†å…¬å¼æ›´æ–°

**æ—§ç‰ˆ (v1.0)**:
```
Score = Taxon_Match_Weight Ã— log10(RA% + 1) Ã— 100
```

**æ–°ç‰ˆ (v2.0)**:
```
Final_Score = Base_Score Ã— Host_Match_Weight Ã— Evidence_Weight
```

### 3. è¾“å‡ºæ ¼å¼å˜åŒ–

#### è¡¨1: åŠŸèƒ½æ±‡æ€»è¡¨
**æ–°å¢åˆ—**:
- `Mean_Host_Match`: å¹³å‡å®¿ä¸»åŒ¹é…æƒé‡
- `Mean_Evidence_Weight`: å¹³å‡è¯æ®ç­‰çº§æƒé‡

**åˆ—åå˜æ›´**:
- `Potential_Score_Sum` â†’ `Final_Score_Sum`

#### è¡¨2: æ½œåœ¨å…±ç”ŸèŒæ˜ç»†è¡¨
**æ–°å¢åˆ—**:
- `Base_Score`: åŸºç¡€å¾—åˆ†
- `Host_Match_Weight`: å®¿ä¸»åŒ¹é…æƒé‡
- `Host_Match_Level`: å®¿ä¸»åŒ¹é…ç­‰çº§
- `Evidence_Level`: è¯æ®ç­‰çº§ (1-5)
- `Evidence_Weight`: è¯æ®ç­‰çº§æƒé‡

**åˆ—åå˜æ›´**:
- `Potential_Score` â†’ `Final_Score`

### 4. å‘½ä»¤è¡Œå‚æ•°

**æ–°å¢å‚æ•°**:
- `--host`: å®¿ä¸»ç‰©ç§æ‹‰ä¸å (å¯é€‰)
- `--host-db`: å®¿ä¸»åˆ†ç±»æ•°æ®åº“è·¯å¾„ (å¯é€‰ï¼Œå¯è‡ªåŠ¨æ¨å¯¼)

---

## ğŸ“‚ ç›¸å…³æ–‡ä»¶

### ä¸»è¦æ–‡ä»¶
1. **`s16_predictor.py`** (å·²æ›´æ–°)
   - æ ¸å¿ƒé¢„æµ‹è„šæœ¬
   - æ–°å¢å®¿ä¸»åŒ¹é…å’Œè¯æ®ç­‰çº§åŠŸèƒ½

2. **`s16_predictor_CHANGELOG.md`** (æ–°å»º)
   - è¯¦ç»†æ›´æ–°æ—¥å¿—
   - åŒ…å«ç®—æ³•åŸç†ã€è¯„åˆ†å…¬å¼ã€ä½¿ç”¨ç¤ºä¾‹

3. **`s16_predictor_USAGE.md`** (æ–°å»º)
   - å¿«é€Ÿä½¿ç”¨æŒ‡å—
   - åŒ…å«å‚æ•°è¯´æ˜ã€è¾“å‡ºè§£è¯»ã€å¸¸è§é—®é¢˜

### ä¾èµ–æ–‡ä»¶
4. **`../database/symbiord/record_db.tsv`** (å·²æ›´æ–°)
   - æ–°å¢ `evidence_level` åˆ—
   - æ–°å¢ `host_order`, `host_family` åˆ—

5. **`../database/host_taxonomy/insect_taxonomy.db`** (å·²å­˜åœ¨)
   - å®¿ä¸»åˆ†ç±»æ•°æ®åº“
   - ç”¨äºæŸ¥è¯¢å®¿ä¸»çš„ç›®ã€ç§‘ã€å±ä¿¡æ¯

6. **`../utils/host_query.py`** (å·²å­˜åœ¨)
   - å®¿ä¸»æŸ¥è¯¢å·¥å…·
   - å·²æ•´åˆåˆ° s16_predict
---

## ğŸ”§ ä»£ç æ”¹åŠ¨ä½ç½®

### æ–°å¢æ–¹æ³•
- **ç¬¬52-105è¡Œ**: `_query_host_taxonomy()` - æŸ¥è¯¢å®¿ä¸»åˆ†ç±»
- **ç¬¬107-153è¡Œ**: `_calculate_hosh_score()` - è®¡ç®—å®¿ä¸»åŒ¹é…å¾—åˆ†

### ä¿®æ”¹æ–¹æ³•
- **ç¬¬11-50è¡Œ**: `__init__()` - æ–°å¢å®¿ä¸»ç›¸å…³å‚æ•°å’Œæƒé‡é…ç½®
- **ç¬¬155-197è¡Œ**: `_load_database()` - æ–°å¢å­—æ®µæ£€æŸ¥ (evidence_level, host_order, host_family)
- **ç¬¬259-353è¡Œ**: `predict()` - æ•´åˆå®¿ä¸»åŒ¹é…å’Œè¯æ®ç­‰çº§åˆ°è¯„åˆ†è®¡ç®—
- **ç¬¬355-400è¡Œ**: è¾“å‡ºè¡¨1 - æ–°å¢ç»Ÿè®¡åˆ—
- **ç¬¬402-423è¡Œ**: è¾“å‡ºè¡¨2 - æ–°å¢è¯¦ç»†åˆ—
- **ç¬¬425-448è¡Œ**: `__main__` - æ–°å¢å‘½ä»¤è¡Œå‚æ•°

### æ–°å¢ä¾èµ–
- **ç¬¬7è¡Œ**: `import sqliteæŸ¥è¯¢å®¿ä¸»æ•°æ®åº“
- **ç¬¬8è¡Œ**: `from pathlib import Path` - ç”¨äºè·¯å¾„å¤„ç†

---

## âœ… æµ‹è¯•ç»“æœ

### æµ‹è¯•åœºæ™¯
1. âœ… ä¸å¸¦å®¿ä¸»å‚æ•°ï¼ˆå‘åå…¼å®¹ï¼‰
2. âœ… å¸¦å®¿ä¸»å‚æ•°ï¼ˆæ–°åŠŸèƒ½ï¼‰
3. âœ… å®¿ä¸»æ•°æ®åº“è‡ªåŠ¨æ¨å¯¼
4. âœ… è¾“å‡ºæ ¼å¼éªŒè¯
5. âœ… è¯„åˆ†å…¬å¼éªŒè¯

### æµ‹è¯•æ•°æ®
- è¾“å…¥: `tests/test_data.tsv` (538,623 reads)
- æ•°æ®åº“: `isympred/database/symbiont_record/record_db.tsv` (2,168 records)
- å®¿ä¸»: `Drosophila melanogaster`

### æµ‹è¯•ç»“æœ
- âœ… å®¿ä¸»æŸ¥è¯¢æˆåŠŸ: Order=Diptera, Family=Drosophilidae, Genus=Drosophila
- âœ… Mean_Host_Match ä» 1.0 å˜ä¸º 0.89-0.94
- âœ… Host_Match_Level æ­£ç¡®æ˜¾ç¤º (Order/General)
- âœ… Evidence_Level å’Œ Evidence_Weight æ­£ç¡®è®¡ç®—
- âœ… è¯„åˆ†å…¬å¼éªŒè¯é€šè¿‡: 69.8 Ã— 1.1 Ã— 1.15 = 88.3

---

## ğŸ“Š ä½¿ç”¨ç¤ºä¾‹

### åŸºç¡€ç”¨æ³•ï¼ˆä¸æŒ‡å®šå®¿ä¸»ï¼‰
```bash
python isympred/predictors/s16_predictor.py \
    -i otu_table.tsv \
    -d isympred/database/symbiont_record/record_db.tsv \
    -o results.tsv
```

### æ¨èç”¨æ³•ï¼ˆæŒ‡å®šå®¿ä¸»ï¼‰
```bash
python isympred/predictors/s16_predictor.py \
    -i otu_table.tsv \
    -d isympred/database/symbiont_record/record_db.tsv \
    -o results.tsv \
    --host "Apis mellifera"
```

---

## ğŸ“ å…³é”®æ¦‚å¿µ

### å®¿ä¸»åŒ¹é…æƒé‡è¡¨
| åŒ¹é…ç­‰çº§ | æƒé‡ | è¯´æ˜ |
|---------|------|------|
| Species | 1.5 | ç‰©ç§çº§ç²¾ç¡®åŒ¹é… |
| Genus | 1.3 | å±çº§åŒ¹é… |
| Family | 1.2 | ç§‘çº§åŒ¹é… |
| Order | 1.1 | ç›®çº§åŒ¹é… |
| General | 1.0 | é€šç”¨è®°å½• |
| Mismatch | 0.8 | å®Œå…¨ä¸åŒ¹é… |

### è¯æ®ç­‰çº§æƒé‡è¡¨
| è¯æ®ç­‰çº§ | æƒé‡ | ç»„æˆ |
|---------|------|------|
| 5 | 1.5 | Symbiont + Genome + Top Journal |
| 4 | 1.3 | Symbiont + Genome |
| 3 | 1.15 | Symbiont + Top Journal |
| 2 | 1.0 | Symbiont only |
| 1 | 0.8 | å…¶ä»– |

---

## ğŸ”„ å‘åå…¼å®¹æ€§

- âœ… **å®Œå…¨å…¼å®¹æ—§ç‰ˆæ•°æ®åº“**: ç¼ºå¤±å­—æ®µä¼šä½¿ç”¨é»˜è®¤å€¼
- âœ… **å¯é€‰å®¿ä¸»å‚æ•°**: ä¸æä¾›æ—¶è¡Œä¸ºä¸æ—§ç‰ˆä¸€è‡´
- âœ… **è¾“å‡ºæ ¼å¼æ‰©å±•**: æ–°å¢åˆ—ä¸å½±å“æ—§ç‰ˆè„šæœ¬è¯»å–æ ¸å¿ƒåˆ—

---

## ğŸ“ åç»­å»ºè®®

1. **æ•°æ®åº“æ›´æ–°**: ç¡®ä¿ä½¿ç”¨åŒ…å« `evidence_level` çš„æœ€æ–°æ•°æ®åº“
2. **å®¿ä¸»ä¿¡æ¯**: å°½å¯èƒ½æä¾›å®¿ä¸»ä¿¡æ¯ä»¥æé«˜é¢„æµ‹å‡†ç¡®æ€§
3. **ç»“æœç­›é€‰**: å…³æ³¨ `Evidence_Level â‰¥ 4` å’Œ `Host_Match_Level = Species/Genus` çš„è®°å½•
4. **æ‰¹é‡åˆ†æ**: å¯ä»¥ç¼–å†™è„šæœ¬æ‰¹é‡å¤„ç†å¤šä¸ªæ ·æœ¬

---

## ğŸ“š æ–‡æ¡£ç´¢å¼•

- **è¯¦ç»†æ›´æ–°æ—¥å¿—**: `s16_predictor_CHANGELOG.md` (å®Œæ•´æŠ€æœ¯æ–‡æ¡£)
- **ä½¿ç”¨æŒ‡å—**: `s16_predictor_USAGE.md` (å¿«é€Ÿä¸Šæ‰‹æŒ‡å—)
- **æœ¬æ–‡æ¡£**: `s16_predictor_UPDATE_SUMMARY.md` (æ›´æ–°æ‘˜è¦)

---

**æœ€åæ›´æ–°**: 2026-01-07
**ç‰ˆæœ¬**: v2.0
